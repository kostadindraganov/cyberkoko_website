import{r as f,b as w,u as P,cK as R,bK as I,cL as S,ba as m,cO as D,cP as O,cQ as x}from"./sanity-CNmy13iJ.js";const C=n=>{const e=w.c(14),{comlink:t,perspective:b}=n;let a;e[0]!==b?(a=S(b)?R:{apiVersion:I},e[0]=b,e[1]=a):a=e[1];const s=P(a);let o,c;e[2]!==s||e[3]!==t?(o=()=>{const i=s.listen('*[!(_id in path("_.**"))]',{},{effectFormat:"mendoza",events:["welcome","mutation","reconnect"],includePreviousRevision:!1,includeResult:!1,tag:"presentation-documents",visibility:"transaction"}).pipe(m(L)),v=i.pipe(m(N),D({bufferSize:1,refCount:!1})),y=t.on("visual-editing/snapshot-welcome",async()=>({event:await new Promise(d=>{v.pipe(O()).subscribe(h=>{d(h)})})})),E=i.pipe(m(T)),_=i.pipe(m(z)),g=x(v,_,E).subscribe(d=>{t.post("presentation/snapshot-event",{event:d})});return()=>{y(),g.unsubscribe()}},c=[s,t],e[2]=s,e[3]=t,e[4]=o,e[5]=c):(o=e[4],c=e[5]),f.useEffect(o,c);let u,r;e[6]!==s||e[7]!==t?(u=()=>t.on("visual-editing/fetch-snapshot",async i=>({snapshot:await s.getDocument(i.documentId,{tag:"document.snapshots"})})),r=[s,t],e[6]=s,e[7]=t,e[8]=u,e[9]=r):(u=e[8],r=e[9]),f.useEffect(u,r);let p,l;return e[10]!==s||e[11]!==t?(p=()=>t.on("visual-editing/mutate",async i=>s.dataRequest("mutate",i,{visibility:"async",returnDocuments:!0})),l=[s,t],e[10]=s,e[11]=t,e[12]=p,e[13]=l):(p=e[12],l=e[13]),f.useEffect(p,l),null};var K=f.memo(C);function L(n){return n.type==="welcome"||n.type==="reconnect"||n.type==="mutation"}function N(n){return n.type==="welcome"}function T(n){return n.type==="reconnect"}function z(n){return n.type==="mutation"}export{K as default};
