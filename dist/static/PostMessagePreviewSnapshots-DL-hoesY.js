import{a4 as w,a5 as P,r as s,cn as S,al as _,cR as E,aJ as M,cS as x,cT as R,cU as k,cV as U,aT as D,bM as h,cQ as T,bg as $,ba as j,av as y}from"./sanity-CNmy13iJ.js";function F(u){return w(function(t,r){var i=!1,n=0;t.subscribe(P(r,function(a){return(i||(i=!u(a,n++)))&&r.next(a)}))})}const I=u=>{const{comlink:t,refs:r,perspective:i}=u,n=S(),a=_(),c=s.useMemo(()=>new E,[]),l=s.useMemo(()=>c.asObservable().pipe(M(b=>R(b.map(e=>{const f={...e,_id:k(e._id)},m=i==="previewDrafts"?n.observeForPreview(f,a.get(f._type)).pipe(U(),F(o=>o.snapshot===null)):D,v={...e,_id:h(e._id)},g=n.observeForPreview(v,a.get(v._type));return T(g.pipe($(m)),m).pipe(j(o=>!!o.snapshot),y(o=>{const p=o.snapshot;return{_id:h(p._id),title:p.title,subtitle:p.subtitle,description:p.description,imageUrl:p.imageUrl}}))}))),x(0)),[n,c,a,i]),d=s.useRef([]);return s.useEffect(()=>{const b=l.subscribe(e=>{t.post("presentation/preview-snapshots",{snapshots:e}),d.current=e});return()=>{b.unsubscribe()}},[t,l]),s.useEffect(()=>t.on("visual-editing/preview-snapshots",()=>({snapshots:d.current})),[t]),s.useEffect(()=>{c.next(r)},[r,c]),null};var V=s.memo(I);export{V as default};
