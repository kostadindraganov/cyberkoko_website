import{r as A,b as h,a6 as D,_ as q,u as U,cK as L,bK as C,cL as V,bM as K,cW as B,j as S,cX as W,cY as Y,cZ as X}from"./sanity-CNmy13iJ.js";function Z(n){const{validation:e}=n.type;if(!e)return!1;const r=Array.isArray(e)?e:[e];for(const i of r){let f=!1;const p=new Proxy({},{get:(g,d)=>()=>(d==="required"&&(f=!0),p)});if(typeof i=="function"&&(i(p),f)||typeof i=="object"&&i!==null&&"_required"in i&&i._required==="required")return!0}return!1}function v(n,e){let r=n;for(;r;){if(r.name===e||r.type&&r.type.name===e)return!0;r=r.type}return!1}function z(n){return v(n,"object")||n.jsonType==="object"||"fields"in n}function G(n){return v(n,"array")}function x(n){return v(n,"reference")}function H(n){return v(n,"crossDatasetReference")}function J(n){return v(n,"string")}function Q(n){return v(n,"number")}function M(n){let e=n;for(;e;){if(!e.type)return e;e=e.type}}function R(n){return"fields"in n?n.type?R(n.type).concat(n.fields):n.fields:[]}function T(n){const e=new Set;function r(o,a){if(!e.has(o)){if(e.add(o),"fields"in o)for(const l of R(o)){const t=M(l.type);if(t.name==="document"){a.add(t);continue}let s;o.type.type?s=l.type.type.name:"jsonType"in o.type&&(s=l.type.jsonType),(s==="object"||s==="block")&&(x(l.type)?l.type.to.forEach(u=>a.add(u.type)):a.add(l.type)),r(l.type,a)}else if("of"in o)for(const l of o.of)r(l,a)}}const i=new Map;n.getTypeNames().forEach(o=>{const a=n.get(o);if(a===void 0||a.type===null)return;const l=new Set;r(a,l),i.set(a,l),e.clear()});const f=[],p=new Set,g=new Set;function d(o){if(g.has(o)||p.has(o))return;p.add(o);const a=i.get(o);a!==void 0&&a.forEach(l=>d(l)),p.delete(o),g.add(o),f.includes(o.name)||f.unshift(o.name)}for(const[o]of i)d(o);return f}const ee=function(n){const e=h.c(6),{schemaType:r,theme:i}=n,{theme:f,scheme:p,tone:g}=i;let d;e[0]===Symbol.for("react.memo_cache_sentinel")?(d=new W,e[0]=d):d=e[0];const o=d,a=r.icon;let l;return e[1]!==a||e[2]!==p||e[3]!==f||e[4]!==g?(l=a?S.jsx(Y,{sheet:o.instance,children:S.jsx(X,{theme:f,scheme:p,tone:g,children:A.isValidElement(a)?a:S.jsx(a,{})})}):null,e[1]=a,e[2]=p,e[3]=f,e[4]=g,e[5]=l):l=e[5],l},te=n=>({_id:{type:"objectField",name:"_id",value:{type:"string"}},_type:{type:"objectField",name:"_type",value:{type:"string",value:n}},_createdAt:{type:"objectField",name:"_createdAt",value:{type:"string"}},_updatedAt:{type:"objectField",name:"_updatedAt",value:{type:"string"}},_rev:{type:"objectField",name:"_rev",value:{type:"string"}}});function ne(n){var r;const e=(r=n.options)==null?void 0:r.list;return e&&Array.isArray(e)?{type:"union",of:e.map(i=>({type:"string",value:typeof i=="string"?i:i.value}))}:{type:"string"}}function re(n){var r;const e=(r=n.options)==null?void 0:r.list;return e&&Array.isArray(e)?{type:"union",of:e.map(i=>({type:"number",value:typeof i=="number"?i:i.value}))}:{type:"number"}}function F(n,e=!1){const r={_ref:{type:"objectField",name:"_ref",value:{type:"string"}},_type:{type:"objectField",name:"_type",value:{type:"string",value:"reference"}},_weak:{type:"objectField",name:"_weak",value:{type:"boolean"},optional:!0}};return e&&(r._key={type:"objectField",name:"_key",value:{type:"string"}}),{type:"object",fields:r,dereferencesTo:n}}function ie(n){const e=oe(n);return e.length===1?F(e[0]):{type:"union",of:e.map(r=>({type:"unionOption",name:r,value:F(r)}))}}function oe(n){const e=N(n);return[...new Set([...e.map(r=>r.name)])]}function N(n){const e="to"in n?n.to:[];return"type"in n&&x(n.type)?[...N(n.type),...e]:e}const E=new Map([["text",{type:"string"}],["url",{type:"string"}],["datetime",{type:"string"}],["date",{type:"string"}],["boolean",{type:"boolean"}],["email",{type:"string"}]]);function se(n,e){const r=new Set,{schema:i,basePath:f}=n;return T(i).map(t=>{const s=i.get(t);if(s===void 0)return;const u=g(s);if(u!==null)return u.type==="type"&&r.add(s),u}).filter(t=>t!==void 0);function p(t){if(t.icon)return B.renderToString(S.jsx(ee,{schemaType:t,theme:e}))}function g(t){let s;if(t.type?s=t.type.name:"jsonType"in t&&(s=t.jsonType),s==="document"){const y=d(t);return y.type==="unknown"?null:{type:"document",name:t.name,title:typeof t.title=="string"?t.title:void 0,icon:p(t),fields:{...te(t.name),...y.fields}}}const u=o(t);return u.type==="unknown"?null:u.type==="object"?{name:t.name,type:"type",value:{type:"object",fields:{_type:{type:"objectField",name:"_type",value:{type:"string",value:t.name}},...u.fields}}}:{name:t.name,title:typeof t.title=="string"?t.title:void 0,type:"type",value:u}}function d(t){const s={};for(const u of R(t)){const y=o(u.type);y!==null&&(s[u.name]={type:"objectField",name:u.name,title:typeof u.type.title=="string"?u.type.title:void 0,value:y,optional:Z(u)===!1})}return{type:"object",fields:s}}function o(t){var u,y,b,c;if(((u=M(t))==null?void 0:u.name)==="document")return F(t.name);if(r.has(t.type))return{type:"inline",name:t.type.name};if(((b=(y=t.type)==null?void 0:y.type)==null?void 0:b.name)==="object")return{type:"inline",name:t.type.name};if(J(t))return ne(t);if(Q(t))return re(t);const s=E.get(((c=t.type)==null?void 0:c.name)||"");if(s)return s;if(t.type&&E.has(t.type.name))return E.get(t.type.name);if(H(t))return{type:"unknown"};if(x(t))return ie(t);if(G(t))return l(t);if(z(t))return d(t);throw new Error(`Type "${t.name}" not found`)}function a(t,s){var b;const{options:u}=t;if(!u)return;const y={...u};return u.insertMenu&&(y.insertMenu={...u.insertMenu,views:(b=u.insertMenu.views)==null?void 0:b.map(c=>c.name==="grid"?{name:"grid",previewImageUrls:c.previewImageUrl?s.reduce((m,{name:j})=>{var w;const _=(w=c.previewImageUrl)==null?void 0:w.call(c,j);if(!_)return m;try{new URL(_),m[j]=_}catch{m[j]=new URL(_,`${window.location.origin}${f?`${f}/`:""}`).toString()}return m},{}):void 0}:c)}),y}function l(t){const s=[];for(const c of t.of){let m=o(c);const j={type:"unionOption",icon:p(c),name:c.name,title:typeof c.title=="string"?c.title:void 0,value:m};m.type==="inline"?m={type:"object",fields:{_key:k()},rest:m}:m.type==="object"&&(m.rest={type:"object",fields:{_key:k()}}),j.value=m,s.push(j)}if(s.length===0)return{type:"null"};if(s.length>1)return{type:"union",of:s,options:a(t,s)};const{name:u,title:y,value:b}=s[0];return{type:"array",of:{type:"arrayItem",name:u,title:typeof y=="string"?y:void 0,value:b}}}}function k(){return{type:"objectField",name:"_key",value:{type:"string"}}}function ue(n){const e=n.reduce((r,{id:i,path:f})=>(r[i]?r[i].add(f):r[i]=new Set([f]),r),{});return Object.entries(e)}function ae(n){const e=h.c(12),{comlink:r,perspective:i}=n,f=D(),p=q();let g,d;e[0]!==r||e[1]!==p||e[2]!==f?(g=()=>{try{const s=se(f,p);return r.post("presentation/schema",{schema:s}),r.on("visual-editing/schema",()=>({schema:s}))}catch{return}},d=[r,p,f],e[0]=r,e[1]=p,e[2]=f,e[3]=g,e[4]=d):(g=e[3],d=e[4]),A.useEffect(g,d);let o;e[5]!==i?(o=V(i)?L:{apiVersion:C},e[5]=i,e[6]=o):o=e[6];const a=U(o);let l,t;return e[7]!==a||e[8]!==r||e[9]!==i?(l=()=>r.on("visual-editing/schema-union-types",async s=>{const u=ue(s.paths),y=await Promise.all(u.map(async c=>{const[m,j]=c,_=Array.from(j),w=`*[_id == $id][0]{${_.map(fe).join(",")}}`,I=await a.fetch(w,{id:K(m)},{tag:"presentation-schema",perspective:i}),P=_.map((O,$)=>({path:O,type:I[$]}));return{id:m,paths:P}})),b=new Map;return y.forEach(c=>{b.set(c.id,new Map(c.paths.map(le)))}),{types:b}}),t=[r,a,i],e[7]=a,e[8]=r,e[9]=i,e[10]=l,e[11]=t):(l=e[10],t=e[11]),A.useEffect(l,t),null}function le(n){const{path:e,type:r}=n;return[e,r]}function fe(n,e){return`"${e}": ${n}[0]._type`}var pe=A.memo(ae);export{pe as default};
